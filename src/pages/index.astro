---
export const prerender = false;

import Layout from '../layouts/Layout.astro';
import Hero from '../components/Hero.astro';
import Section from '../components/Section.astro';
import ServiceCard from '../components/ServiceCard.astro';
import Button from '../components/Button.astro';
import Card from '../components/Card.astro';
import { prisma } from '../lib/prisma';

// Default services with icons (icons are kept locally as they're not easily CMS-editable)
const defaultServices = [
  {
    id: 'strategie-rse',
    title: 'Stratégie RSE',
    description: 'Définissez une stratégie de responsabilité sociétale alignée avec vos valeurs et les attentes de vos parties prenantes.',
    icon: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M12 2L2 7l10 5 10-5-10-5z"/>
      <path d="M2 17l10 5 10-5"/>
      <path d="M2 12l10 5 10-5"/>
    </svg>`,
    href: '/services/strategie-rse',
  },
  {
    id: 'transition-ecologique',
    title: 'Transition écologique',
    description: 'Accompagnement vers une activité plus respectueuse de l\'environnement : bilan carbone, économie circulaire, éco-conception.',
    icon: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"/>
      <path d="M12 6v6l4 2"/>
    </svg>`,
    href: '/services/transition-ecologique',
  },
  {
    id: 'formation',
    title: 'Formation & sensibilisation',
    description: 'Formez vos équipes aux enjeux du développement durable et engagez-les dans votre démarche de transformation.',
    icon: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
      <circle cx="9" cy="7" r="4"/>
      <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
      <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
    </svg>`,
    href: '/services/formation',
  },
];

// Get services from database
const servicesPage = await prisma.pageContent.findUnique({
  where: { slug: 'services' },
});

// Merge database content with default icons
type DbService = { id: string; title: string; summary: string; href: string };
const dbServices = servicesPage?.content as DbService[] | null;

const services = dbServices
  ? dbServices.map((dbService) => {
      const defaultService = defaultServices.find((s) => s.id === dbService.id);
      return {
        title: dbService.title,
        description: dbService.summary,
        icon: defaultService?.icon || defaultServices[0].icon,
        href: dbService.href,
      };
    })
  : defaultServices.map((s) => ({
      title: s.title,
      description: s.description,
      icon: s.icon,
      href: s.href,
    }));

const values = [
  {
    title: 'Expertise',
    description: 'Une connaissance approfondie des enjeux environnementaux et sociétaux contemporains.',
  },
  {
    title: 'Pragmatisme',
    description: 'Des solutions concrètes et adaptées à votre contexte, pas de dogmatisme.',
  },
  {
    title: 'Engagement',
    description: 'Un accompagnement sincère vers une transformation durable et pérenne.',
  },
];
---

<Layout title="Accueil">
  <!-- Hero Section -->
  <Hero
    title="Accompagnons ensemble votre transition vers un modèle durable"
    subtitle="AC-ingiénierie vous guide dans votre démarche de développement durable, RSE et transition écologique. Des solutions pragmatiques pour un impact positif et mesurable."
    ctaText="Découvrir nos services"
    ctaHref="/services"
    secondaryCtaText="Nous contacter"
    secondaryCtaHref="/contact"
  />

  <!-- Services Section -->
  <Section id="services" variant="default">
    <header class="section-header">
      <h2>Nos services</h2>
      <p class="lead">
        Un accompagnement sur-mesure pour chaque étape de votre transformation.
      </p>
    </header>

    <div class="services-grid">
      {services.map((service) => (
        <ServiceCard
          title={service.title}
          description={service.description}
          icon={service.icon}
          href={service.href}
        />
      ))}
    </div>
  </Section>

  <!-- About Section -->
  <Section id="a-propos" variant="alt">
    <div class="about-grid">
      <div class="about-content">
        <h2>Pourquoi AC-ingiénierie ?</h2>
        <p class="lead">
          Nous croyons que la transition écologique et sociale est une opportunité de repenser en profondeur votre modèle d'entreprise.
        </p>
        <p>
          Notre approche combine rigueur méthodologique et pragmatisme. Nous ne proposons pas de solutions toutes faites, mais un accompagnement personnalisé qui prend en compte vos contraintes, vos ressources et vos ambitions.
        </p>
        <p>
          L'objectif : des résultats concrets, mesurables et durables dans le temps.
        </p>
        <Button href="/a-propos" variant="outline">
          En savoir plus sur notre approche
        </Button>
      </div>

      <div class="values-list">
        {values.map((value) => (
          <Card variant="default" padding="md">
            <h3 class="value-title">{value.title}</h3>
            <p class="value-description">{value.description}</p>
          </Card>
        ))}
      </div>
    </div>
  </Section>

  <!-- CTA Section -->
  <Section variant="dark" size="lg">
    <div class="cta-content">
      <h2>Prêt à transformer votre entreprise ?</h2>
      <p class="lead">
        Discutons de vos enjeux et de la manière dont nous pouvons vous accompagner.
      </p>
      <div class="cta-actions">
        <Button href="/contact" variant="cta" size="lg">
          Prendre rendez-vous
        </Button>
      </div>
    </div>
  </Section>
</Layout>
